<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Surron Squad HQ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;500;600;700&family=Permanent+Marker&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="surron_squad.css">
  <style>
    /* HQ-specific styles */
    .hq-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    .player-profile {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--squad-shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .profile-details {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .profile-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: var(--squad-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
    }
    
    .profile-info h2 {
      margin: 0 0 0.25rem 0;
      font-size: 1.5rem;
    }
    
    .profile-stats {
      display: flex;
      gap: 1.5rem;
    }
    
    .stat-box {
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--squad-neon);
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: var(--squad-text);
      opacity: 0.8;
    }
    
    .xp-bar {
      background-color: rgba(0, 0, 0, 0.3);
      height: 8px;
      border-radius: 4px;
      width: 100%;
      max-width: 200px;
      margin-top: 0.5rem;
    }
    
    .xp-fill {
      height: 100%;
      border-radius: 4px;
      background-color: var(--squad-neon);
      width: 0%;
    }
    
    .game-modules {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .module-card {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--squad-shadow);
      transition: transform 0.3s;
      position: relative;
      min-height: 250px;
    }
    
    .module-card:hover {
      transform: translateY(-5px);
    }
    
    .module-image {
      width: 100%;
      height: 150px;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      position: relative;
    }
    
    .module-image::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: linear-gradient(to top, rgba(23, 23, 25, 1), transparent);
    }
    
    .module-content {
      padding: 1.5rem;
    }
    
    .module-title {
      margin: 0 0 0.5rem 0;
      font-family: 'Bangers', cursive;
      font-size: 1.8rem;
      color: var(--squad-primary);
    }
    
    .module-description {
      color: var(--squad-text);
      margin: 0 0 1rem 0;
      font-size: 0.9rem;
    }
    
    .module-status {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: white;
      background-color: var(--squad-primary);
    }
    
    .module-status.new {
      background-color: var(--squad-neon);
      color: black;
    }
    
    .module-status.locked {
      background-color: #555;
    }
    
    .btn-module {
      display: inline-block;
      padding: 0.5rem 1rem;
      background-color: var(--squad-primary);
      color: white;
      border-radius: 4px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .btn-module:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .btn-module.locked {
      background-color: #555;
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .character-connection {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    
    .character-card {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      padding: 1.5rem;
      width: 30%;
      box-shadow: var(--squad-shadow);
      position: relative;
      overflow: hidden;
    }
    
    .character-card.charlie {
      border-top: 4px solid #e63946;
    }
    
    .character-card.billy {
      border-top: 4px solid #7d8260;
    }
    
    .character-card.tbd {
      border-top: 4px solid #264653;
    }
    
    .character-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .character-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .character-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .character-name {
      margin: 0;
      font-size: 1.3rem;
    }
    
    .relationship-level {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .relationship-meter {
      display: flex;
      gap: 3px;
      margin-top: 0.5rem;
    }
    
    .relationship-point {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #555;
    }
    
    .relationship-point.filled {
      background-color: var(--squad-primary);
    }
    
    .charlie .relationship-point.filled {
      background-color: #e63946;
    }
    
    .billy .relationship-point.filled {
      background-color: #7d8260;
    }
    
    .tbd .relationship-point.filled {
      background-color: #264653;
    }
    
    .character-action {
      display: block;
      padding: 0.5rem;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.2);
      color: var(--squad-text);
      text-decoration: none;
      border-radius: 4px;
      margin-top: 1rem;
      transition: all 0.2s;
    }
    
    .character-action:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .notifications {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--squad-shadow);
    }
    
    .notifications h2 {
      margin-top: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 0.5rem;
    }
    
    .notification-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-content h3 {
      margin: 0 0 0.25rem 0;
      font-size: 1.1rem;
    }
    
    .notification-content p {
      margin: 0;
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .notification-time {
      font-size: 0.8rem;
      opacity: 0.6;
    }
    
    @media (max-width: 768px) {
      .profile-details {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .profile-stats {
        margin-top: 1rem;
        flex-wrap: wrap;
      }
      
      .character-connection {
        flex-direction: column;
        gap: 1rem;
      }
      
      .character-card {
        width: 100%;
      }
    }
    
    /* Quest Board Styles */
    .quest-list { 
      list-style: none; 
      padding-left: 0; 
    }
    
    .quest-item { 
      margin-bottom: 1.5rem; 
      background: rgba(0,0,0,0.2); 
      padding: 1rem; 
      border-left: 4px solid lime; 
      border-radius: 8px; 
    }
    
    .quest-item.charlie { 
      border-left-color: var(--squad-primary);
    }
    
    .quest-item.billy { 
      border-left-color: #7d8260;
    }
    
    .quest-item.tbd { 
      border-left-color: #264653;
    }
    
    .quest-item button { 
      margin-top: 0.5rem; 
    }
    
    .quest-char-icon {
      display: inline-block;
      margin-right: 0.5rem;
    }
    
    .quest-char-icon.charlie { 
      color: var(--squad-primary); 
    }
    
    .quest-char-icon.billy { 
      color: #7d8260; 
    }
    
    .quest-char-icon.tbd { 
      color: #264653; 
    }
    
    .quest-progress { 
      font-size: 0.9rem; 
      color: lime; 
      margin-bottom: 1rem; 
    }
  </style>
</head>
<body class="surron-squad-theme">
  <div style="margin: 10px 0; text-align: left;">
    <a href="surron_squad.html" class="btn" style="background-color: #e63946; color: #fff;">← Back to Home</a>
  </div>
  <div class="hq-container">
    <header>
      <h1>Squad HQ – Your Command Center</h1>
      <p class="subtitle">Manage your progress, builds, and adventures here.</p>
      
      <div style="margin: 10px 0; text-align: right;">
        <a href="settings.html" class="btn" style="background-color: rgba(23, 23, 25, 0.7);">⚙️ Settings</a>
      </div>
    </header>
    
    <div class="player-profile">
      <div class="profile-details">
        <div class="profile-avatar">R</div>
        <div class="profile-info">
          <h2>Rider</h2>
          <div class="level-info">
            Level <span id="player-level">1</span>
            <div class="xp-bar">
              <div id="xp-fill" class="xp-fill" style="width: 25%;"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="stat-box">
          <div id="currency-value" class="stat-value">250</div>
          <div class="stat-label">SurCoins</div>
        </div>
        <div class="stat-box">
          <div id="reputation-value" class="stat-value">0</div>
          <div class="stat-label">Reputation</div>
        </div>
        <div class="stat-box">
          <div id="builds-value" class="stat-value">0</div>
          <div class="stat-label">Bike Builds</div>
        </div>
        <div class="stat-box">
          <div id="parts-value" class="stat-value">0</div>
          <div class="stat-label">Parts Collected</div>
        </div>
      </div>
    </div>
    
    <!-- Quest Board -->
    <div class="quest-board-panel" style="background-color: rgba(23, 23, 25, 0.7); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--squad-shadow);">
      <h2>Mission Control</h2>
      <div id="quest-board" class="quest-board-panel"></div>
    </div>
    
    <div class="notifications">
      <h2>Latest Updates</h2>
      <div id="notifications-container">
        <!-- Notifications will be filled by JavaScript -->
        <div class="notification-item">
          <div class="notification-icon">🚀</div>
          <div class="notification-content">
            <h3>Welcome to the Squad!</h3>
            <p>Your journey into the world of Surron Squad begins now.</p>
          </div>
          <div class="notification-time">Just now</div>
        </div>
      </div>
    </div>
    
    <div class="game-modules">
      <div class="module-card">
        <div class="module-status new">NEW</div>
        <div class="module-image" style="background-image: url('images/surron-squad-builder-garagepose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">Adventure Mode</h3>
          <p class="module-description">Join Charlie, Billy and TBD on their quest for parts in an interactive story.</p>
          <a href="adventure-engine.html" class="btn-module">Start Adventure</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-image" style="background-image: url('images/surron-squad-builder-garagepose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">Build Your Bike</h3>
          <p class="module-description">Design and customize your perfect Surron with expert parts selection.</p>
          <a href="buildpartsSelector.html" class="btn-module">Enter Workshop</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-status new">NEW</div>
        <div class="module-image" style="background-image: url('images/surron-charlie-alert-pose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">SurCoin Shop</h3>
          <p class="module-description">Spend your hard-earned SurCoins on upgrades, parts, and cosmetic items.</p>
          <a href="surron-shop.html" class="btn-module">Shop Now</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-image" style="background-image: url('images/surron-billy-fishing_ready-pose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">Fishing with Billy</h3>
          <p class="module-description">Relax by the lake and catch some fish to earn extra SurCoins.</p>
          <a href="adventure.html" class="btn-module">Go Fishing</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-status locked">LEVEL 5</div>
        <div class="module-image" style="background-image: url('images/surron-tbd-terminal-ready.png'); filter: brightness(0.5);"></div>
        <div class="module-content">
          <h3 class="module-title">Test Track</h3>
          <p class="module-description">Test your bike builds on challenging terrain and obstacles.</p>
          <a href="#" class="btn-module locked">Locked</a>
        </div>
      </div>
    </div>
    
    <div class="character-connection">
      <div class="character-card charlie">
        <div class="character-header">
          <div class="character-avatar">
            <img src="images/surron-charlie-alert-pose.png" alt="Charlie">
          </div>
          <div>
            <h3 class="character-name">Charlie</h3>
            <div class="relationship-level">Relationship: <span id="charlie-relationship">Acquaintance</span></div>
            <div class="relationship-meter" id="charlie-meter">
              <div class="relationship-point filled"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
            </div>
          </div>
        </div>
        <p class="character-quote">"Let's overvolt it. What's the worst that could happen? Third-degree burns are just spicy memories."</p>
        <a href="adventure-engine.html" class="character-action" id="charlie-adventure-link">Join Charlie's Adventure</a>
      </div>
      
      <div class="character-card billy">
        <div class="character-header">
          <div class="character-avatar">
            <img src="images/surron-billy-fishing_ready-pose.png" alt="Billy">
          </div>
          <div>
            <h3 class="character-name">Billy</h3>
            <div class="relationship-level">Relationship: <span id="billy-relationship">Acquaintance</span></div>
            <div class="relationship-meter" id="billy-meter">
              <div class="relationship-point filled"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
            </div>
          </div>
        </div>
        <p class="character-quote">"I'd rather fish, but I guess we're building bikes. Again."</p>
        <a href="adventure.html" class="character-action">Go Fishing with Billy</a>
      </div>
      
      <div class="character-card tbd">
        <div class="character-header">
          <div class="character-avatar">
            <img src="images/surron-tbd-terminal-ready.png" alt="TBD">
          </div>
          <div>
            <h3 class="character-name">TBD</h3>
            <div class="relationship-level">Relationship: <span id="tbd-relationship">Acquaintance</span></div>
            <div class="relationship-meter" id="tbd-meter">
              <div class="relationship-point filled"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
            </div>
          </div>
        </div>
        <p class="character-quote">"Parts compatibility matrix loaded. Efficiency optimization at 97.3%."</p>
        <a href="#" class="character-action">TBD's Lab (Locked)</a>
      </div>
    </div>
    
  </div>

  <!-- For developers: Hidden debug tools -->
  <div style="margin-top: 20px; padding: 10px; border: 1px dashed #666; background: rgba(0,0,0,0.2); display: none;" id="debug-panel">
    <h4>Developer Debug Panel</h4>
    <button onclick="window.debugPlayerState()">Debug Player State</button>
    <button onclick="window.localStorage.removeItem('surronSquadPlayerState'); location.reload();">Reset Game</button>
    <button onclick="document.getElementById('debug-log').innerHTML = ''">Clear Log</button>
    <div id="debug-log" style="max-height: 200px; overflow-y: auto; margin-top: 10px; background: #111; padding: 5px; font-family: monospace; font-size: 12px;"></div>
  </div>
  
  <!-- Toast notification container -->
  <div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;"></div>
  
  <!-- Show debug panel with key combo Ctrl+Alt+D -->
  <script>
    // Toast notification function
    function showToast(message, type = 'success', duration = 5000) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `squad-toast ${type}`;
      notification.style.position = 'relative';
      notification.style.marginTop = '10px';
      notification.style.backgroundColor = type === 'success' ? 'var(--squad-neon)' : 
                                         type === 'warning' ? 'var(--squad-primary)' : 
                                         '#e63946';
      notification.style.color = type === 'success' ? 'black' : 'white';
      notification.style.padding = '1rem';
      notification.style.borderRadius = '8px';
      notification.style.boxShadow = 'var(--squad-shadow)';
      notification.style.transition = 'opacity 0.3s, transform 0.3s';
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(20px)';
      
      notification.textContent = message;
      
      // Add to container
      const container = document.getElementById('toast-container');
      container.appendChild(notification);
      
      // Trigger animation
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      
      // Remove after specified duration
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          if (container.contains(notification)) {
            container.removeChild(notification);
          }
        }, 300);
      }, duration);
    }
    
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.altKey && e.key === 'd') {
        const debugPanel = document.getElementById('debug-panel');
        debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
      }
    });
    
    // Override console.log to also display in debug panel
    const originalConsoleLog = console.log;
    console.log = function() {
      // Call original console.log
      originalConsoleLog.apply(console, arguments);
      
      // Also log to debug panel
      const debugLog = document.getElementById('debug-log');
      if (debugLog) {
        const message = Array.from(arguments).map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg) : arg
        ).join(' ');
        
        const logEntry = document.createElement('div');
        logEntry.textContent = `> ${message}`;
        debugLog.appendChild(logEntry);
        debugLog.scrollTop = debugLog.scrollHeight;
      }
    };
  </script>
  
  <script type="module" src="game/GameBridge.js"></script>
  <script type="module" src="game/AdventureIntegration.js"></script>
  <!-- Import GameCore instead of player-state.js -->
  <script type="module">
    import GameCore from './game/GameCore.js';
    
    // Make GameCore available globally for older scripts that expect it
    window.GameCore = GameCore;
    
    // After GameCore loads, initialize the page
    document.addEventListener('DOMContentLoaded', async function() {
      // Initialize GameCore (loads player state from storage)
      await GameCore.boot();
      
      // Initialize HQ functions
      loadNotifications();
      loadMessages();
      
      // Check adventure access
      checkAdventureAccess();
      
      // Update UI with player data
      updatePlayerProfile();
      updateCharacterRelationships();
      checkUnlockedFeatures();
      checkNewRewards();

      // Show debug panel for developers on ctrl+d
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'd') {
          const debugPanel = document.getElementById('debug-panel');
          debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
        }
      });

      // Expose debug function globally
      window.debugPlayerState = function() {
        GameCore.debugPlayerState();
      };
    });

    // Function to load notifications
    function loadNotifications() {
      // Get the notification container
      const container = document.getElementById('notifications-container');
      if (!container) return;
      
      // Clear existing notifications
      container.innerHTML = '';
      
      // Get player state
      const playerState = GameCore.getPlayerState();
      if (!playerState) return;
      
      // Add default notifications
      addNotification('👋', 'Welcome to Squad HQ', 'Check your missions and adventure progress');
      
      // Add level-based notification
      addNotification('🏆', 'Current Level', `You are level ${playerState.level} rider`, false);
      
      // Add pending quest notification if there are incomplete quests
      if (playerState.completedMissions && playerState.completedMissions.length < 3) {
        addNotification('📋', 'Pending Quests', 'You have quests waiting at the Quest Board', false);
      }
    }

    // Function to load squad messages
    function loadMessages() {
      // Get the messages container
      const container = document.getElementById('messages-container');
      if (!container) return;
      
      // Clear existing messages
      container.innerHTML = '';
      
      // Default messages if none in state
      const defaultMessages = [
        { from: 'charlie', text: 'Hey! Check out the new bike builds. I added some INSANE mods!', time: '2 hours ago' },
        { from: 'billy', text: 'Anyone want to go fishing this weekend? The lake is perfect right now.', time: '5 hours ago' },
        { from: 'tbd', text: 'Performance analysis complete. New controller modifications available.', time: '1 day ago' }
      ];
      
      // Get messages from state or use defaults
      const playerState = GameCore.getPlayerState();
      const messages = (playerState && playerState.messages) || defaultMessages;
      
      // Add messages to container
      messages.forEach(message => {
        const msgElement = document.createElement('div');
        msgElement.className = `message ${message.from}`;
        
        msgElement.innerHTML = `
          <div class="message-avatar">
            <img src="images/surron-${message.from}-alert-pose.png" alt="${message.from}">
          </div>
          <div class="message-content">
            <div class="message-header">
              <span class="message-sender">${message.from.charAt(0).toUpperCase() + message.from.slice(1)}</span>
              <span class="message-time">${message.time}</span>
            </div>
            <div class="message-text">${message.text}</div>
          </div>
        `;
        
        container.appendChild(msgElement);
      });
    }

    // Update all player state references in the file
    function updatePlayerProfile() {
      const playerState = GameCore.getPlayerState();
      if (!playerState) return;
      
      // Update player name and level
      document.getElementById('player-name').textContent = playerState.name || 'Rider';
      document.getElementById('player-level').textContent = `Level ${playerState.level}`;
      
      // Update XP bar
      const xpPercent = (playerState.xp / playerState.xpToNextLevel) * 100;
      document.getElementById('xp-fill').style.width = `${Math.min(xpPercent, 100)}%`;
      document.getElementById('xp-text').textContent = `${playerState.xp} / ${playerState.xpToNextLevel} XP`;
      
      // Update stats
      document.getElementById('currency-value').textContent = playerState.currency;
      document.getElementById('reputation-value').textContent = playerState.reputation;
      document.getElementById('builds-value').textContent = playerState.builds.length;
      document.getElementById('parts-value').textContent = playerState.inventory.length;
    }
    
    function updateCharacterRelationships() {
      const playerState = GameCore.getPlayerState();
      if (!playerState) return;
      
      // Update relationship meters
      updateRelationshipMeter('charlie', playerState.relationships.charlie);
      updateRelationshipMeter('billy', playerState.relationships.billy);
      updateRelationshipMeter('tbd', playerState.relationships.tbd);
      
      // Update relationship text descriptions
      document.getElementById('charlie-relationship').textContent = getRelationshipLabel(playerState.relationships.charlie);
      document.getElementById('billy-relationship').textContent = getRelationshipLabel(playerState.relationships.billy);
      document.getElementById('tbd-relationship').textContent = getRelationshipLabel(playerState.relationships.tbd);
    }

    function updateRelationshipMeter(character, level) {
      const meter = document.getElementById(`${character}-meter`);
      const points = meter.querySelectorAll('.relationship-point');
      
      // Reset all points
      points.forEach(point => point.classList.remove('filled'));
      
      // Fill points based on level
      for (let i = 0; i < level && i < points.length; i++) {
        points[i].classList.add('filled');
      }
    }
    
    function getRelationshipLabel(level) {
      if (level <= 2) return 'Acquaintance';
      if (level <= 4) return 'Friend';
      if (level <= 6) return 'Good Friend';
      if (level <= 8) return 'Close Ally';
      return 'Trusted Partner';
    }

    function checkAdventureAccess() {
      const playerState = GameCore.getPlayerState();
      if (!playerState) return;
      
      const charlieAdventureLink = document.getElementById('charlie-adventure-link');
      if (charlieAdventureLink) {
        // Check if player has completed Charlie's build review quest
        const charlieQuestCompleted = playerState.completedMissions.includes('charlie_build_review');
        
        console.log('Charlie quest status check - completed:', charlieQuestCompleted);
        
        if (charlieQuestCompleted) {
          // Quest is completed, adventure is available
          charlieAdventureLink.classList.remove('locked');
          charlieAdventureLink.textContent = 'Join Charlie\'s Midnight Raid';
          charlieAdventureLink.href = 'adventure-engine.html';
        } else {
          // Quest not yet completed, show proper status
          const hasBikes = playerState.builds && playerState.builds.length > 0;
          
          if (hasBikes) {
            // Player has built a bike but not completed the quest
            charlieAdventureLink.classList.add('locked');
            charlieAdventureLink.textContent = 'Complete Charlie\'s Quest First';
            charlieAdventureLink.href = '#quest-board';
            
            // Show guidance toast
            if (typeof showToast === 'function') {
              showToast('Complete "Charlie\'s Build Review" quest to unlock the Midnight Raid adventure!');
            }
          } else {
            // Player hasn't built a bike yet
            charlieAdventureLink.classList.add('locked');
            charlieAdventureLink.textContent = 'Build a Bike First';
            charlieAdventureLink.href = 'buildpartsSelector.html';
          }
        }
      }
    }
    
    function checkUnlockedFeatures() {
      // This would check player level and unlocked features
      const playerState = GameCore.getPlayerState();
      console.log("Checking unlocked features, player state:", playerState);
      
      const testTrackModule = document.querySelector('.module-card:nth-child(5)');
      const testTrackButton = testTrackModule.querySelector('.btn-module');
      
      if (playerState && playerState.level >= 5) {
        console.log("Player level is high enough to unlock test track:", playerState.level);
        // Unlock test track at level 5
        testTrackModule.querySelector('.module-status').textContent = 'NEW';
        testTrackModule.querySelector('.module-status').classList.remove('locked');
        testTrackModule.querySelector('.module-status').classList.add('new');
        testTrackModule.querySelector('.module-image').style.filter = '';
        testTrackButton.textContent = 'Enter Test Track';
        testTrackButton.classList.remove('locked');
        testTrackButton.href = 'test-track.html';
      }
    }
    
    // Check for new rewards or changes since last visit
    function checkNewRewards() {
      const playerState = GameCore.getPlayerState();
      if (!playerState) return;
      
      // Get last visited timestamp from localStorage
      const lastVisited = localStorage.getItem('squadHqLastVisit') || 0;
      const now = Date.now();
      
      // Check inventory for new items since last visit
      const newItems = checkNewInventoryItems(lastVisited);
      
      // Check for new builds since last visit
      const newBuilds = checkNewBuilds(lastVisited);
      
      // Check for completed scenes since last visit
      const newScenes = checkNewCompletedScenes(lastVisited);
      
      // Check for relationship changes
      const relationshipChanges = checkRelationshipChanges(lastVisited);
      
      // Create notifications for all new items
      newItems.forEach(item => {
        addNotification('📦', 'New Item Acquired', `You've acquired ${item.name || item.id}`);
      });
      
      // Create notifications for new builds
      newBuilds.forEach(build => {
        addNotification('🔧', 'New Bike Build', `You've created "${build.name}"`);
      });
      
      // Create notifications for completed scenes
      if (newScenes.length > 0) {
        addNotification('🚀', 'Adventure Progress', `You've completed ${newScenes.length} new adventure scenes`);
      }
      
      // Create notifications for relationship changes
      relationshipChanges.forEach(change => {
        const icon = getCharacterIcon(change.character);
        addNotification(icon, 'Relationship Updated', 
          `Your relationship with ${getCharacterName(change.character)} is now ${getRelationshipLabel(change.level)}`);
      });
      
      // Add a special welcome back notification if it's been a while
      if (lastVisited > 0 && now - lastVisited > 24 * 60 * 60 * 1000) {
        addNotification('👋', 'Welcome Back!', 'The Squad missed you! See what\'s new in the workshop.');
      }
      
      // Update last visited time
      localStorage.setItem('squadHqLastVisit', now.toString());
    }
    
    // Check for new inventory items since last visit
    function checkNewInventoryItems(lastVisited) {
      const playerState = GameCore.getPlayerState();
      if (!playerState || !playerState.inventory) return [];
      
      // In a real implementation, we'd track timestamps for each item
      // For now, we'll just return the most recent items (max 3)
      return playerState.inventory.slice(-3);
    }
    
    // Check for new builds since last visit
    function checkNewBuilds(lastVisited) {
      const playerState = GameCore.getPlayerState();
      if (!playerState || !playerState.builds) return [];
      
      // In a real implementation, we'd track timestamps for each build
      // For now, we'll just return the most recent builds (max 2)
      return playerState.builds.slice(-2);
    }
    
    // Check for newly completed scenes since last visit
    function checkNewCompletedScenes(lastVisited) {
      const playerState = GameCore.getPlayerState();
      if (!playerState || !playerState.adventureProgress) return [];
      
      // In a real implementation, we'd track timestamps for scene completion
      // For now, we'll just return the most recent scenes (max 5)
      const completedScenes = playerState.adventureProgress.completedScenes || [];
      return completedScenes.slice(-5);
    }
    
    // Check for relationship changes since last visit
    function checkRelationshipChanges(lastVisited) {
      const playerState = GameCore.getPlayerState();
      if (!playerState || !playerState.relationships) return [];
      
      // In a real implementation, we'd track timestamps for relationship changes
      // For now, we'll just check if any relationship is above level 1
      const changes = [];
      
      for (const character in playerState.relationships) {
        const level = playerState.relationships[character];
        if (level > 1) {
          changes.push({
            character: character,
            level: level
          });
        }
      }
      
      // Just return the most recent one for now
      return changes.slice(-1);
    }
    
    // Get character icon for notifications
    function getCharacterIcon(character) {
      switch(character) {
        case 'charlie': return '🔥';
        case 'billy': return '🎣';
        case 'tbd': return '🧠';
        default: return '👤';
      }
    }
    
    // Get character name for notifications
    function getCharacterName(character) {
      switch(character) {
        case 'charlie': return 'Charlie';
        case 'billy': return 'Billy';
        case 'tbd': return 'TBD';
        default: return character;
      }
    }
    
    // Function to add a notification
    function addNotification(icon, title, message, animate = true) {
      const container = document.getElementById('notifications-container');
      if (!container) return;
      
      const notification = document.createElement('div');
      notification.className = 'notification-item';
      
      if (animate) {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(20px)';
        notification.style.transition = 'opacity 0.5s, transform 0.5s';
      }
      
      notification.innerHTML = `
        <div class="notification-icon">${icon}</div>
        <div class="notification-content">
          <h3>${title}</h3>
          <p>${message}</p>
        </div>
        <div class="notification-time">Just now</div>
      `;
      
      // Add to the top
      if (container.firstChild) {
        container.insertBefore(notification, container.firstChild);
      } else {
        container.appendChild(notification);
      }
      
      // Trigger animation if requested
      if (animate) {
        setTimeout(() => {
          notification.style.opacity = '1';
          notification.style.transform = 'translateY(0)';
        }, 10);
      }
    }

    // Function to show toast messages
    function showToast(message, duration = 3000) {
      const container = document.getElementById('toast-container');
      if (!container) return;
      
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      
      container.appendChild(toast);
      
      // Animate in
      setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)';
      }, 10);
      
      // Remove after duration
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(20px)';
        
        // Remove from DOM after fade out
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, duration);
    }
  </script>
  <script type="module">
    import { initQuestBoard } from './quest-board.js';
    import director from './gameplay-director.js';
    
    // Initialize quest board after player state is ready
    document.addEventListener('playerStateReady', function() {
      initQuestBoard();
      
      // Listen for quest completion events
      window.addEventListener('questCompleted', (event) => {
        const questId = event.detail;
        addNotification('📋', 'Quest Completed', `You've completed the ${questId.replace('_', ' ')} quest!`);
        
        // Refresh player profile to show updated stats
        updatePlayerProfile();
        updateCharacterRelationships();
      });
    });
  </script>
  <script type="module" src="adventureUI.js"></script>
</body>
</html> 