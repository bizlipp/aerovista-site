<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Surron Squad HQ</title>
  <!-- Set base URL for all relative paths -->
  <base href="/surron_build/">
  <!-- Import maps to resolve module paths -->
  <script type="importmap">
  {
    "imports": {
      "/StateStackULTRA/": "/surron_build/StateStackULTRA/",
      "/game/": "/surron_build/game/",
      "/selectors/": "/surron_build/selectors/",
      "/ui/": "/surron_build/ui/",
      "/components/": "/surron_build/components/"
    }
  }
  </script>
  <!-- Module import handler -->
  <script>
    // Helper function to monkey patch modules
    document.addEventListener('DOMContentLoaded', function() {
      console.log("Setting up module patch");
      
      // Add our patch to handle ../../ style imports
      // This intercepts imports before they fail
      try {
        // Patch ComponentBase importing
        window.ComponentBase = {
          default: class ComponentBase {
            constructor() { 
              console.log("Using stubbed ComponentBase");
              this.state = {}; 
            }
            mount() {}
            unmount() {}
            addListener() {}
            render() {}
          }
        };
        
        // Expose the store globally
        window.storeExport = { 
          store: {
            getState: () => ({}),
            dispatch: () => {},
            subscribe: () => () => {}
          }
        };
        
        // Expose toast functions globally
        window.showToast = function(message, type = 'info') {
          console.log(`TOAST (${type}): ${message}`);
          // Create a div for the toast
          const toast = document.createElement('div');
          toast.textContent = message;
          toast.style.position = 'fixed';
          toast.style.bottom = '20px';
          toast.style.right = '20px';
          toast.style.background = type === 'error' ? '#ff4444' : '#44ff44';
          toast.style.color = '#fff';
          toast.style.padding = '10px';
          toast.style.borderRadius = '5px';
          toast.style.zIndex = '9999';
          
          document.body.appendChild(toast);
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 3000);
        };
        
        console.log("Module patching setup complete");
      } catch (e) {
        console.error("Failed to set up module patching:", e);
      }
    });
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;500;600;700&family=Permanent+Marker&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="surron_squad.css">
  <style>
    /* HQ-specific styles */
    .hq-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    .player-profile {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--squad-shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .profile-details {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .profile-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: var(--squad-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
    }
    
    .profile-info h2 {
      margin: 0 0 0.25rem 0;
      font-size: 1.5rem;
    }
    
    .profile-stats {
      display: flex;
      gap: 1.5rem;
    }
    
    .stat-box {
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--squad-neon);
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: var(--squad-text);
      opacity: 0.8;
    }
    
    .xp-bar {
      background-color: rgba(0, 0, 0, 0.3);
      height: 8px;
      border-radius: 4px;
      width: 100%;
      max-width: 200px;
      margin-top: 0.5rem;
    }
    
    .xp-fill {
      height: 100%;
      border-radius: 4px;
      background-color: var(--squad-neon);
      width: 0%;
    }
    
    .game-modules {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .module-card {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--squad-shadow);
      transition: transform 0.3s;
      position: relative;
      min-height: 250px;
    }
    
    .module-card:hover {
      transform: translateY(-5px);
    }
    
    .module-image {
      width: 100%;
      height: 150px;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      position: relative;
    }
    
    .module-image::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: linear-gradient(to top, rgba(23, 23, 25, 1), transparent);
    }
    
    .module-content {
      padding: 1.5rem;
    }
    
    .module-title {
      margin: 0 0 0.5rem 0;
      font-family: 'Bangers', cursive;
      font-size: 1.8rem;
      color: var(--squad-primary);
    }
    
    .module-description {
      color: var(--squad-text);
      margin: 0 0 1rem 0;
      font-size: 0.9rem;
    }
    
    .module-status {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.8rem;
      color: white;
      background-color: var(--squad-primary);
    }
    
    .module-status.new {
      background-color: var(--squad-neon);
      color: black;
    }
    
    .module-status.locked {
      background-color: #555;
    }
    
    .btn-module {
      display: inline-block;
      padding: 0.5rem 1rem;
      background-color: var(--squad-primary);
      color: white;
      border-radius: 4px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .btn-module:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .btn-module.locked {
      background-color: #555;
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .character-connection {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    
    .character-card {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      padding: 1.5rem;
      width: 30%;
      box-shadow: var(--squad-shadow);
      position: relative;
      overflow: hidden;
    }
    
    .character-card.charlie {
      border-top: 4px solid #e63946;
    }
    
    .character-card.billy {
      border-top: 4px solid #7d8260;
    }
    
    .character-card.tbd {
      border-top: 4px solid #264653;
    }
    
    .character-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .character-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .character-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .character-name {
      margin: 0;
      font-size: 1.3rem;
    }
    
    .relationship-level {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .relationship-meter {
      display: flex;
      gap: 3px;
      margin-top: 0.5rem;
    }
    
    .relationship-point {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #555;
    }
    
    .relationship-point.filled {
      background-color: var(--squad-primary);
    }
    
    .charlie .relationship-point.filled {
      background-color: #e63946;
    }
    
    .billy .relationship-point.filled {
      background-color: #7d8260;
    }
    
    .tbd .relationship-point.filled {
      background-color: #264653;
    }
    
    .character-action {
      display: block;
      padding: 0.5rem;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.2);
      color: var(--squad-text);
      text-decoration: none;
      border-radius: 4px;
      margin-top: 1rem;
      transition: all 0.2s;
    }
    
    .character-action:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .notifications {
      background-color: rgba(23, 23, 25, 0.7);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--squad-shadow);
    }
    
    .notifications h2 {
      margin-top: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 0.5rem;
    }
    
    .notification-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-content h3 {
      margin: 0 0 0.25rem 0;
      font-size: 1.1rem;
    }
    
    .notification-content p {
      margin: 0;
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .notification-time {
      font-size: 0.8rem;
      opacity: 0.6;
    }
    
    @media (max-width: 768px) {
      .profile-details {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .profile-stats {
        margin-top: 1rem;
        flex-wrap: wrap;
      }
      
      .character-connection {
        flex-direction: column;
        gap: 1rem;
      }
      
      .character-card {
        width: 100%;
      }
    }
    
    /* Quest Board Styles */
    .quest-list { 
      list-style: none; 
      padding-left: 0; 
    }
    
    .quest-item { 
      margin-bottom: 1.5rem; 
      background: rgba(0,0,0,0.2); 
      padding: 1rem; 
      border-left: 4px solid lime; 
      border-radius: 8px; 
    }
    
    .quest-item.charlie { 
      border-left-color: var(--squad-primary);
    }
    
    .quest-item.billy { 
      border-left-color: #7d8260;
    }
    
    .quest-item.tbd { 
      border-left-color: #264653;
    }
    
    .quest-item button { 
      margin-top: 0.5rem; 
    }
    
    .quest-char-icon {
      display: inline-block;
      margin-right: 0.5rem;
    }
    
    .quest-char-icon.charlie { 
      color: var(--squad-primary); 
    }
    
    .quest-char-icon.billy { 
      color: #7d8260; 
    }
    
    .quest-char-icon.tbd { 
      color: #264653; 
    }
    
    .quest-progress { 
      font-size: 0.9rem; 
      color: lime; 
      margin-bottom: 1rem; 
    }
  </style>
</head>
<body class="surron-squad-theme">
  <div style="margin: 10px 0; text-align: left;">
    <a href="surron_squad.html" class="btn" style="background-color: #e63946; color: #fff;">‚Üê Back to Home</a>
  </div>
  <div class="hq-container">
    <header>
      <h1>Squad HQ ‚Äì Your Command Center</h1>
      <p class="subtitle">Manage your progress, builds, and adventures here.</p>
      
      <div style="margin: 10px 0; text-align: right;">
        <a href="settings.html" class="btn" style="background-color: rgba(23, 23, 25, 0.7);">‚öôÔ∏è Settings</a>
      </div>
    </header>
    
    <div class="player-profile">
      <div class="profile-details">
        <div class="profile-avatar">R</div>
        <div class="profile-info">
          <h2>Rider</h2>
          <div class="level-info">
            Level <span id="player-level">1</span>
            <div class="xp-bar">
              <div id="xp-fill" class="xp-fill" style="width: 25%;"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="stat-box">
          <div id="currency-value" class="stat-value">250</div>
          <div class="stat-label">SurCoins</div>
        </div>
        <div class="stat-box">
          <div id="reputation-value" class="stat-value">0</div>
          <div class="stat-label">Reputation</div>
        </div>
        <div class="stat-box">
          <div id="builds-value" class="stat-value">0</div>
          <div class="stat-label">Bike Builds</div>
        </div>
        <div class="stat-box">
          <div id="parts-value" class="stat-value">0</div>
          <div class="stat-label">Parts Collected</div>
        </div>
      </div>
    </div>
    
    <!-- Quest Board -->
    <div class="quest-board-panel" style="background-color: rgba(23, 23, 25, 0.7); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--squad-shadow);">
      <h2>Mission Control</h2>
      <div id="quest-board" class="quest-board-panel"></div>
    </div>
    
    <div class="notifications">
      <h2>Latest Updates</h2>
      <div id="notifications-container">
        <!-- Notifications will be filled by JavaScript -->
        <div class="notification-item">
          <div class="notification-icon">üöÄ</div>
          <div class="notification-content">
            <h3>Welcome to the Squad!</h3>
            <p>Your journey into the world of Surron Squad begins now.</p>
          </div>
          <div class="notification-time">Just now</div>
        </div>
      </div>
    </div>
    
    <div class="game-modules">
      <div class="module-card">
        <div class="module-status new">NEW</div>
        <div class="module-image" style="background-image: url('images/surron-squad-builder-garagepose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">Adventure Mode</h3>
          <p class="module-description">Join Charlie, Billy and TBD on their quest for parts in an interactive story.</p>
          <a href="adventure-engine.html" class="btn-module">Start Adventure</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-image" style="background-image: url('images/surron-squad-builder-garagepose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">Build Your Bike</h3>
          <p class="module-description">Design and customize your perfect Surron with expert parts selection.</p>
          <a href="buildpartsSelector.html" class="btn-module">Enter Workshop</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-status new">NEW</div>
        <div class="module-image" style="background-image: url('images/surron-charlie-alert-pose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">SurCoin Shop</h3>
          <p class="module-description">Spend your hard-earned SurCoins on upgrades, parts, and cosmetic items.</p>
          <a href="surron-shop.html" class="btn-module">Shop Now</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-image" style="background-image: url('images/surron-billy-fishing_ready-pose.png');"></div>
        <div class="module-content">
          <h3 class="module-title">Fishing with Billy</h3>
          <p class="module-description">Relax by the lake and catch some fish to earn extra SurCoins.</p>
          <a href="MainGameShell.html?activity=fishing" class="btn-module">Go Fishing</a>
        </div>
      </div>
      
      <div class="module-card">
        <div class="module-status locked">LEVEL 5</div>
        <div class="module-image" style="background-image: url('images/surron-tbd-terminal-ready.png'); filter: brightness(0.5);"></div>
        <div class="module-content">
          <h3 class="module-title">Test Track</h3>
          <p class="module-description">Test your bike builds on challenging terrain and obstacles.</p>
          <a href="#" class="btn-module locked">Locked</a>
        </div>
      </div>
    </div>
    
    <div class="character-connection">
      <div class="character-card charlie">
        <div class="character-header">
          <div class="character-avatar">
            <img src="images/surron-charlie-alert-pose.png" alt="Charlie">
          </div>
          <div>
            <h3 class="character-name">Charlie</h3>
            <div class="relationship-level">Relationship: <span id="charlie-relationship">Acquaintance</span></div>
            <div class="relationship-meter" id="charlie-meter">
              <div class="relationship-point filled"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
            </div>
          </div>
        </div>
        <p class="character-quote">"Let's overvolt it. What's the worst that could happen? Third-degree burns are just spicy memories."</p>
        <a href="adventure-engine.html" class="character-action" id="charlie-adventure-link">Join Charlie's Adventure</a>
      </div>
      
      <div class="character-card billy">
        <div class="character-header">
          <div class="character-avatar">
            <img src="images/surron-billy-fishing_ready-pose.png" alt="Billy">
          </div>
          <div>
            <h3 class="character-name">Billy</h3>
            <div class="relationship-level">Relationship: <span id="billy-relationship">Acquaintance</span></div>
            <div class="relationship-meter" id="billy-meter">
              <div class="relationship-point filled"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
            </div>
          </div>
        </div>
        <p class="character-quote">"I'd rather fish, but I guess we're building bikes. Again."</p>
        <a href="MainGameShell.html?activity=fishing&character=billy" class="character-action">Go Fishing with Billy</a>
      </div>
      
      <div class="character-card tbd">
        <div class="character-header">
          <div class="character-avatar">
            <img src="images/surron-tbd-terminal-ready.png" alt="TBD">
          </div>
          <div>
            <h3 class="character-name">TBD</h3>
            <div class="relationship-level">Relationship: <span id="tbd-relationship">Acquaintance</span></div>
            <div class="relationship-meter" id="tbd-meter">
              <div class="relationship-point filled"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
              <div class="relationship-point"></div>
            </div>
          </div>
        </div>
        <p class="character-quote">"Parts compatibility matrix loaded. Efficiency optimization at 97.3%."</p>
        <a href="#" class="character-action">TBD's Lab (Locked)</a>
      </div>
    </div>
    
  </div>

  <!-- For developers: Hidden debug tools -->
  <div style="margin-top: 20px; padding: 10px; border: 1px dashed #666; background: rgba(0,0,0,0.2); display: none;" id="debug-panel">
    <h4>Developer Debug Panel</h4>
    <button onclick="window.debugPlayerState()">Debug Player State</button>
    <button onclick="window.localStorage.removeItem('surronSquadPlayerState'); location.reload();">Reset Game</button>
    <button onclick="document.getElementById('debug-log').innerHTML = ''">Clear Log</button>
    <div id="debug-log" style="max-height: 200px; overflow-y: auto; margin-top: 10px; background: #111; padding: 5px; font-family: monospace; font-size: 12px;"></div>
  </div>
  
  <!-- Toast notification container -->
  <div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;"></div>
  
  <!-- Show debug panel with key combo Ctrl+Alt+D -->
  <script>
    // Toast notification function
    function showToast(message, type = 'success', duration = 5000) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `squad-toast ${type}`;
      notification.style.position = 'relative';
      notification.style.marginTop = '10px';
      notification.style.backgroundColor = type === 'success' ? 'var(--squad-neon)' : 
                                         type === 'warning' ? 'var(--squad-primary)' : 
                                         '#e63946';
      notification.style.color = type === 'success' ? 'black' : 'white';
      notification.style.padding = '1rem';
      notification.style.borderRadius = '8px';
      notification.style.boxShadow = 'var(--squad-shadow)';
      notification.style.transition = 'opacity 0.3s, transform 0.3s';
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(20px)';
      
      notification.textContent = message;
      
      // Add to container
      const container = document.getElementById('toast-container');
      container.appendChild(notification);
      
      // Trigger animation
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      
      // Remove after specified duration
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          if (container.contains(notification)) {
            container.removeChild(notification);
          }
        }, 300);
      }, duration);
    }
    
    // Function to update player profile with the latest state
    function updatePlayerProfile() {
      try {
        console.log("Updating player profile...");
        
        // Access GameCore if available in window
        if (!window.GameCore) {
          console.error("GameCore not available for updatePlayerProfile");
          return;
        }
        
        const state = window.GameCore.getPlayerState();
        if (!state) {
          console.error("Player state not available");
          return;
        }
        
        // Update player level
        const levelEl = document.getElementById('player-level');
        if (levelEl) levelEl.textContent = state.level || 1;
        
        // Update XP bar
        const xpEl = document.getElementById('player-xp');
        if (xpEl) xpEl.textContent = state.xp || 0;
        
        const xpToNextEl = document.getElementById('player-xp-to-next');
        if (xpToNextEl) xpToNextEl.textContent = state.xpToNextLevel || 100;
        
        const xpProgressEl = document.getElementById('xp-progress');
        if (xpProgressEl) {
          const percentage = Math.min(100, Math.floor((state.xp / state.xpToNextLevel) * 100) || 0);
          xpProgressEl.style.width = `${percentage}%`;
        }
        
        // Update currency
        const currencyEl = document.getElementById('player-currency');
        if (currencyEl) currencyEl.textContent = state.currency || 0;
        
        // Update inventory count
        const inventoryEl = document.getElementById('inventory-count');
        if (inventoryEl) inventoryEl.textContent = state.inventory ? state.inventory.length : 0;
        
        console.log("Player profile updated successfully");
      } catch (error) {
        console.error("Error updating player profile:", error);
      }
    }
    
    // Function to update character relationships display
    function updateCharacterRelationships() {
      try {
        console.log("Updating character relationships...");
        
        // Access GameCore if available in window
        if (!window.GameCore) {
          console.error("GameCore not available for updateCharacterRelationships");
          return;
        }
        
        const state = window.GameCore.getPlayerState();
        if (!state || !state.relationships) {
          console.error("Relationships data not available");
          return;
        }
        
        const relationships = state.relationships;
        
        // Update character relationships UI
        updateCharacter('charlie', relationships.charlie || 1);
        updateCharacter('billy', relationships.billy || 1);
        updateCharacter('tbd', relationships.tbd || 1);
        
        console.log("Character relationships updated successfully");
      } catch (error) {
        console.error("Error updating character relationships:", error);
      }
    }
    
    // Helper function for updating a single character's relationship
    function updateCharacter(character, level) {
      // Update relationship level text
      const relationshipEl = document.getElementById(`${character}-relationship`);
      if (relationshipEl) {
        relationshipEl.textContent = getRelationshipLabel(level);
      }
      
      // Update relationship meter
      const meterEl = document.getElementById(`${character}-meter`);
      if (meterEl) {
        const points = meterEl.querySelectorAll('.relationship-point');
        points.forEach((point, index) => {
          point.className = index < level ? 'relationship-point filled' : 'relationship-point';
        });
      }
    }
    
    // Helper function to get relationship label based on level
    function getRelationshipLabel(level) {
      if (level <= 1) return 'Acquaintance';
      if (level <= 3) return 'Friend';
      if (level <= 5) return 'Good Friend';
      if (level <= 7) return 'Close Friend';
      if (level <= 9) return 'BFF';
      return 'Squad Legend';
    }
    
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.altKey && e.key === 'd') {
        const debugPanel = document.getElementById('debug-panel');
        debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
      }
    });
    
    // Override console.log to also display in debug panel
    const originalConsoleLog = console.log;
    console.log = function() {
      // Call original console.log
      originalConsoleLog.apply(console, arguments);
      
      // Also log to debug panel
      const debugLog = document.getElementById('debug-log');
      if (debugLog) {
        const message = Array.from(arguments).map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg) : arg
        ).join(' ');
        
        const logEntry = document.createElement('div');
        logEntry.textContent = `> ${message}`;
        debugLog.appendChild(logEntry);
        debugLog.scrollTop = debugLog.scrollHeight;
      }
    };
  </script>
  
  <script type="module">
    console.log("Squad HQ: Loading modules...");
    
    // Try importing modules with error handling
    let GameCore, director;
    
    try {
      // Import modules one by one with error handling
      const gameCoreMod = await import('./game/GameCore.js');
      console.log("GameCore module loaded successfully");
      GameCore = gameCoreMod.default;
      
      try {
        // Create loader for QuestBoardComponent 
        async function loadQuestBoardComponent() {
          try {
            // Pre-load the dependencies that QuestBoardComponent needs
            // This creates a facade for the modules it needs
            window.moduleCache = window.moduleCache || {};
            
            // Create stand-in for StateStackULTRA/store
            try {
              window.moduleCache.gameStore = await import('./StateStackULTRA/store/gameStore.js');
              console.log("Pre-loaded gameStore successfully");
            } catch (e) {
              console.warn("Failed to pre-load gameStore, creating mock");
              window.moduleCache.gameStore = {
                store: { 
                  getState: () => ({}),
                  dispatch: () => {},
                  subscribe: () => {}
                }
              };
            }
            
            // Create stand-in for selectors
            try {
              window.moduleCache.questSelectors = await import('./selectors/questSelectors.js');
              window.moduleCache.playerSelectors = await import('./selectors/playerSelectors.js');
              console.log("Pre-loaded selectors successfully");
            } catch (e) {
              console.warn("Failed to pre-load selectors, creating mocks");
              window.moduleCache.questSelectors = { getActiveQuests: () => [] };
              window.moduleCache.playerSelectors = { getPlayerLevel: () => 1 };
            }
            
            // Create stand-in for toast
            try {
              window.moduleCache.popupToast = await import('./game/popup-toast.js');
              console.log("Pre-loaded popup-toast successfully");
            } catch (e) {
              console.warn("Failed to pre-load popup-toast, creating mock");
              window.moduleCache.popupToast = { 
                showToast: (msg) => console.log("TOAST:", msg)
              };
            }
            
            // Now load QuestBoardComponent with our pre-loaded dependencies
            const questBoardMod = await import('./components/QuestBoardComponent.js');
            console.log("QuestBoard component loaded successfully");
            return questBoardMod.default;
          } catch (error) {
            console.error("QuestBoard component failed to load:", error);
            throw error;
          }
        }
        
        // Use our custom loader
        const QuestBoardComponent = await loadQuestBoardComponent();
        
        // Mount the component after DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
          const questBoardContainer = document.getElementById('quest-board');
          if (questBoardContainer && QuestBoardComponent) {
            try {
              const questBoard = new QuestBoardComponent();
              questBoard.mount(questBoardContainer);
              console.log("QuestBoard component mounted");
            } catch (mountError) {
              console.error("Failed to mount QuestBoard:", mountError);
              questBoardContainer.innerHTML = `
                <div style="padding: 20px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                  <h3>Quests</h3>
                  <p>Quest system is currently unavailable. Please check back later.</p>
                </div>
              `;
            }
          }
        });
      } catch (error) {
        console.error("Error loading QuestBoardComponent:", error);
        
        // Create a simple fallback component if import fails
        document.addEventListener('DOMContentLoaded', () => {
          const questBoardContainer = document.getElementById('quest-board');
          if (questBoardContainer) {
            questBoardContainer.innerHTML = `
              <div style="padding: 20px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                <h3>Quests</h3>
                <p>Quest system is currently unavailable. Please check back later.</p>
              </div>
            `;
            console.log("Fallback quest board content added");
          }
        });
      }
      
      try {
        const directorMod = await import('./gameplay-director.js');
        console.log("Director module loaded successfully");
        director = directorMod.default;
      } catch (error) {
        console.error("Error loading gameplay-director.js:", error);
        // Simple fallback
        director = {
          initialize: () => console.log("Using fallback director"),
          processState: () => {},
          checkAchievements: () => {},
          handleEvent: () => {}
        };
      }
      
      // Initialize with GameCore
      document.addEventListener('DOMContentLoaded', async function() {
        try {
          // Boot GameCore with error handling
          console.log("Booting GameCore...");
          try {
            await GameCore.boot();
            console.log("GameCore initialized in Squad HQ");
          } catch (bootError) {
            // Handle the specific DataStackULTRA error about 'main' model
            if (bootError.message && bootError.message.includes('Model instance with ID main not found')) {
              console.warn("Non-critical DataStackULTRA error detected, continuing:", bootError.message);
              // We can continue despite this error
            } else {
              // Re-throw other errors
              throw bootError;
            }
          }
          
          // Update player profile with latest state
          if (typeof updatePlayerProfile === 'function') {
            updatePlayerProfile();
          } else {
            console.warn("updatePlayerProfile function not found");
          }
          
          if (typeof updateCharacterRelationships === 'function') {
            updateCharacterRelationships();
          } else {
            console.warn("updateCharacterRelationships function not found");
          }
          
          // Listen for quest completion events
          window.addEventListener('questCompleted', (event) => {
            const questId = event.detail;
            if (typeof addNotification === 'function') {
              addNotification('üìã', 'Quest Completed', `You've completed the ${questId.replace('_', ' ')} quest!`);
            }
            
            // Refresh player profile to show updated stats
            if (typeof updatePlayerProfile === 'function') {
              updatePlayerProfile();
            }
            if (typeof updateCharacterRelationships === 'function') {
              updateCharacterRelationships();
            }
          });
          
          // Show success toast
          showToast("Game loaded successfully!", "success");
          
        } catch (error) {
          console.error("Error during Squad HQ initialization:", error);
          showToast("Error loading game: " + error.message, "error", 10000);
          
          // Show debug panel to help diagnose
          const debugPanel = document.getElementById('debug-panel');
          if (debugPanel) {
            debugPanel.style.display = 'block';
          }
        }
      });
      
    } catch (error) {
      console.error("Fatal error loading GameCore module:", error);
      showToast("Failed to load game modules: " + error.message, "error", 10000);
      
      // Show debug panel
      const debugPanel = document.getElementById('debug-panel');
      if (debugPanel) {
        debugPanel.style.display = 'block';
      }
    }
  </script>
  <script type="module">
    // Simple import of adventure UI module
    (async function() {
      try {
        const adventureUI = await import('./adventureUI.js');
        console.log("AdventureUI module loaded successfully");
      } catch (error) {
        console.error("Error loading adventureUI.js:", error);
      }
    })();
  </script>
</body>
</html> 